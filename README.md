# Tensor Logic サンプルプログラムの解説

## 📊 Tensor Logicとは？

**Tensor Logic**は、**テンソル演算**（多次元配列の計算）と**論理推論**（三段論法などの論理的思考）を統一する新しいプログラミング手法です。Pedro Domingos氏によって提案され、アインシュタインの総和規約（einsum）を使って、論理ルールを数学的に表現します。

### 主な特徴

- **統一された表現**: 論理推論も機械学習もテンソル演算で表現
- **効率的な計算**: GPUで高速に並列計算可能
- **解釈可能性**: 推論のプロセスが追跡可能
- **スケーラビリティ**: 大規模なデータにも対応

---

## 🚀 クイックスタート

### 環境のセットアップ

```bash
# 仮想環境の作成
python3 -m venv venv
source venv/bin/activate

# 依存関係のインストール
pip install numpy

# サンプルプログラムの実行
python tensor_logic_basic.py
```

---

## 📝 サンプル解説

### 例1: 簡単な論理推論（三段論法）

#### コンセプト
古典的な三段論法をテンソル演算で実装します。

#### 前提と結論
- **前提1**: 「ソクラテスは人間である」(A = 1.0)
- **前提2**: 「人間ならば動物である」(A→B)
- **結論**: 「ソクラテスは動物である」(B = 1.0)

#### 実行結果
```
結果:
B (ソクラテスは動物): [1.]
```

#### テンソル演算の仕組み
```python
# einsum記法による推論
# 'i,ij->j' は「ベクトルと行列の掛け算」を表す
result = np.einsum('i,ij->j', A, A_implies_B)
```

- `i`: 入力ベクトルのインデックス（人間かどうか）
- `ij`: 変換行列のインデックス（人間→動物）
- `j`: 出力ベクトルのインデックス（動物かどうか）

#### 応用例
- 自動推論システム
- 知識ベースシステム
- エキスパートシステム

---

### 例2: 知識グラフでの関係推論

#### コンセプト
社会ネットワークにおける「友達の友達」関係を推論します。

#### 入力データ
```
元の友達関係:
       太郎  花子  次郎
太郎   0.0   0.9   0.3
花子   0.9   0.0   0.8
次郎   0.3   0.8   0.0
```

- 太郎と花子: 強い友達関係（0.9）
- 花子と次郎: 強い友達関係（0.8）
- 太郎と次郎: 弱い関係（0.3）

#### 実行結果
```
友達の友達（推論結果）:
太郎 -> 次郎: 0.72 (友達の友達スコア)
花子 -> 太郎: 0.24 (友達の友達スコア)
```

#### 重要なポイント
直接は0.3だった太郎→次郎の関係が、花子を経由することで**0.72に強化**されました。これは、共通の友達を通じた間接的なつながりの強さを表しています。

#### テンソル演算の仕組み
```python
# 行列の掛け算で「友達の友達」を計算
# 'ij,jk->ik' は2つの関係行列を合成
friend_of_friend = np.einsum('ij,jk->ik', is_friend, is_friend)
```

#### 応用例
- ソーシャルネットワーク分析
- 推薦システム（「友達がいいねした商品」の推薦）
- コミュニティ検出
- 影響力の伝播分析

---

### 例3: ファジィ論理推論

#### コンセプト
不確実な状況（確率的な天気予報）での意思決定を行います。

#### 入力データ
```
天気の確率:
- 晴れ: 0.6 (60%)
- 曇り: 0.3 (30%)
- 雨: 0.1 (10%)

天気ごとの活動適性:
           ピクニック  読書  映画
晴れ         0.9      0.3   0.2
曇り         0.5      0.7   0.6
雨           0.1      0.9   0.9
```

#### 実行結果
```
推奨活動スコア:
ピクニック: 0.70
読書: 0.48
映画: 0.39

最も推奨される活動: ピクニック
```

#### 計算の詳細
ピクニックのスコア計算：
```
0.6 × 0.9  (晴れの場合)
+ 0.3 × 0.5  (曇りの場合)
+ 0.1 × 0.1  (雨の場合)
= 0.70
```

#### テンソル演算の仕組み
```python
# 天気の確率と活動適性を掛け合わせる
# 'i,ij->j' で期待値を計算
recommended = np.einsum('i,ij->j', weather, weather_to_activity)
```

#### 応用例
- 天気予報に基づく活動推薦アプリ
- リスク評価と意思決定支援システム
- ファジィ制御（エアコン、洗濯機など）
- ポートフォリオ最適化

---

### 例4: ニューラル・シンボリック統合

#### コンセプト
機械学習（ニューラルネットワーク）と論理推論を融合させた分類タスクです。

#### 入力データ
```
動物の特徴（観測データ）:
       毛  鳴く  飛ぶ
犬     1    1    0
猫     1    1    0
鳥     0    1    1
魚     0    0    1
```

#### 学習された重み
```
特徴からカテゴリへの変換行列:
         哺乳類  鳥類  魚類
毛        0.5    0.0   0.0
鳴く      0.3    0.3   0.0
飛ぶ      0.0    0.6   0.4
```

この重みは、通常、ニューラルネットワークの学習（バックプロパゲーション）によって最適化されます。

#### 実行結果
```
犬:
  哺乳類: 0.80  ← 正しく分類
  鳥類: 0.30
  魚類: 0.00

猫:
  哺乳類: 0.80  ← 正しく分類
  鳥類: 0.30
  魚類: 0.00

鳥:
  哺乳類: 0.30
  鳥類: 0.90   ← 正しく分類
  魚類: 0.40

魚:
  哺乳類: 0.00
  鳥類: 0.60
  魚類: 0.40   ← スコアが低い（改善の余地）
```

#### 結果の解釈

**犬と猫の分類:**
- 「毛がある」(1) × 0.5 = 0.5 → 哺乳類スコアに寄与
- 「鳴く」(1) × 0.3 = 0.3 → 哺乳類スコアに寄与
- 合計: 0.80 → 正しく哺乳類と判定

**鳥の分類:**
- 「鳴く」(1) × 0.3 = 0.3 → 鳥類スコアに寄与
- 「飛ぶ」(1) × 0.6 = 0.6 → 鳥類スコアに寄与
- 合計: 0.90 → 正しく鳥類と判定

**魚の分類:**
- 「飛ぶ」(1) × 0.4 = 0.4 → 魚類スコア
- 特徴が少なく、判断が不確実（改善が必要）

#### テンソル演算の仕組み
```python
# 特徴ベクトルと重み行列の掛け算
# 'ij,jk->ik' で複数の動物を同時に分類
predictions = np.einsum('ij,jk->ik', animal_features, learned_weights)
```

#### 従来のニューラルネットワークとの違い

| 特徴 | 従来のNN | Tensor Logic |
|------|----------|--------------|
| 解釈可能性 | ブラックボックス | 各重みの意味が明確 |
| デバッグ | 困難 | 容易 |
| 論理的整合性 | 保証なし | ルールベースで保証可能 |
| 学習 | バックプロパゲーション | 同じ手法が使える |

#### 応用例
- 医療診断支援（症状から病気を推論）
- 異常検知システム（正常/異常の判定根拠を説明）
- 自然言語理解（文脈から意図を推論）
- ロボットの行動決定（センサー入力から行動を選択）

---

## 🎯 Tensor Logicの利点

### 1. 統一された表現
論理推論も機械学習も、すべてテンソル演算で表現できます。これにより、異なるパラダイムを組み合わせることが容易になります。

### 2. 効率的な計算
- GPUやTPUで高速に並列計算が可能
- 既存の深層学習フレームワーク（PyTorch、TensorFlowなど）が利用可能
- 大規模データセットにも対応

### 3. 解釈可能性
- 推論のプロセスが追跡可能
- どの事実やルールが結論に寄与したかが明確
- ブラックボックス問題の解決に貢献

### 4. 柔軟性
- 確率的推論（ファジィ論理）が自然に表現できる
- 記号的推論とニューラルネットワークの融合が可能
- ルールの追加・変更が容易

### 5. スケーラビリティ
- 小規模な問題から大規模な問題まで対応
- 分散計算環境でも実行可能

---

## 🔧 実装の詳細

### アインシュタインの総和規約（einsum）

Tensor Logicの核心は`einsum`（アインシュタインの総和規約）です。

#### 基本的な記法

```python
# ベクトルの内積
np.einsum('i,i->', a, b)  # a・b

# 行列とベクトルの掛け算
np.einsum('ij,j->i', M, v)  # M × v

# 行列の掛け算
np.einsum('ij,jk->ik', A, B)  # A × B

# 要素ごとの掛け算
np.einsum('ij,ij->ij', A, B)  # A ⊙ B

# 転置
np.einsum('ij->ji', A)  # A^T
```

#### 論理演算との対応

| 論理演算 | einsum表記 | 意味 |
|----------|-----------|------|
| AND (∧) | `'i,j->ij'` | 2つの事実の組み合わせ |
| OR (∨) | 最大値演算と組み合わせ | 選言 |
| 含意 (→) | `'i,ij->j'` | ルールの適用 |
| 合成 | `'ij,jk->ik'` | ルールの連鎖 |

---

## 🏗️ Java実装（エンタープライズ版）

### 概要

このプロジェクトには、**Java 21 + Quarkus + Apache Camel** による本格的なエンタープライズ実装も含まれています。

### 主な機能

| 機能 | 説明 | ステータス |
|------|------|-----------|
| **Forward Chaining** | 前向き推論（データ駆動） | ✅ 実装済み |
| **Backward Chaining** | 後向き推論（目標駆動） | ✅ 実装済み |
| **Namespace** | ルールのネームスペース管理 | ✅ **NEW!** |
| **LLM統合** | OpenAI GPT連携 | ✅ 実装済み |
| **ルール外部化** | YAMLでルール定義 | ✅ 実装済み |
| **REST API** | HTTP/JSON API | ✅ 実装済み |
| **Apache Camel** | エンタープライズ統合 | ✅ 実装済み |
| **DRD変換** | Decision Requirement Diagram対応 | ✅ 実装済み |

### Backward Chaining（後向き推論） 🆕

**目標から逆向きに推論**する新機能を追加しました！

```bash
# 後向き推論の実行例
curl -X POST http://localhost:8080/api/tensor-logic/backward-chain \
  -H 'Content-Type: application/json' \
  -d '{"goal": "loan_approved"}'
```

**結果:**
```json
{
  "success": true,
  "goal": "loan_approved",
  "goalConfidence": 0.9000,
  "reasoningPath": [
    "applicant_age [既知]",
    "age_implies_adult [既知]",
    "is_adult ← [applicant_age, age_implies_adult]",
    "financially_eligible ← [applicant_income, credit_score_good]",
    "loan_approved ← [is_adult, financially_eligible]"
  ]
}
```

**用途:**
- 🔍 診断システム（「なぜこの結果？」）
- 📊 意思決定の説明責任
- 🎯 効率的な推論（必要な計算のみ）
- 🔧 デバッグと根本原因分析

詳細は [BACKWARD_CHAINING_GUIDE.md](BACKWARD_CHAINING_GUIDE.md) を参照。

### Namespace（ネームスペース） 🆕

**ルールにネームスペースを付けて、適用するルールを選択可能！**

```yaml
# rules/your-rules.yaml
metadata:
  name: "Your Rule Set"
  namespace: "your-namespace"  # ← ネームスペース指定
```

```bash
# 特定のネームスペースのみ適用
curl -X POST http://localhost:8080/api/verify/simple \
  -H 'Content-Type: application/json' \
  -d '{
    "query": "Your question",
    "ruleFile": "rules/your-rules.yaml",
    "namespace": "loan-approval"
  }'

# 全ルール適用（ワイルドカード）
curl -X POST http://localhost:8080/api/verify/simple \
  -d '{
    "query": "Your question",
    "namespace": "*"
  }'
```

**メリット:**
- 🎯 ルールセットの論理的分離
- 🔍 名前衝突の回避
- ⚡ 効率的な推論（必要なルールのみ適用）
- 🧪 テストの容易性

詳細は [NAMESPACE_GUIDE.md](NAMESPACE_GUIDE.md) を参照。

### クイックスタート（Java版）

```bash
# Quarkusアプリケーションの起動
mvn quarkus:dev

# ルールのロード
curl -X POST http://localhost:8080/api/rules/load-resource \
  -H 'Content-Type: application/json' \
  -d '{"resourcePath": "rules/loan-approval-from-drd.yaml"}'

# Backward Chainingのテスト
./test-backward-chaining.sh
```

### ドキュメント

- [TENSOR_LOGIC_ENGINE_GUIDE.md](TENSOR_LOGIC_ENGINE_GUIDE.md) - 完全ガイド
- [BACKWARD_CHAINING_GUIDE.md](BACKWARD_CHAINING_GUIDE.md) - 後向き推論ガイド
- [NAMESPACE_GUIDE.md](NAMESPACE_GUIDE.md) - ネームスペースガイド 🆕
- [DRD_TO_TENSOR_LOGIC_GUIDE.md](DRD_TO_TENSOR_LOGIC_GUIDE.md) - DRD変換ガイド
- [VERIFICATION_REPORT_LOAN_APPROVAL.md](VERIFICATION_REPORT_LOAN_APPROVAL.md) - 検証レポート

---

## 🚀 実用的な応用分野

### 1. 知識グラフの推論
- エンティティ間の関係を推論
- 欠損情報の補完
- 新しい知識の発見

### 2. 推薦システム
- ユーザーとアイテムの関係をテンソルで表現
- 協調フィルタリング
- コンテキストを考慮した推薦

### 3. 自然言語処理
- 意味的推論
- 質問応答システム
- 文書の論理的整合性チェック

### 4. 医療診断支援
- 症状から病気を推論
- 治療法の選択支援
- 推論根拠の説明

### 5. ロボット制御
- センサー入力からの状況認識
- 行動計画の立案
- リアルタイム意思決定

---

## 📚 さらに学ぶために

### 参考資料
- **論文**: "Tensor Logic: The Language of AI" by Pedro Domingos (arXiv:2510.12269)
- **関連技術**: 
  - Einstein Summation Convention
  - Neural-Symbolic Integration
  - Differentiable Logic Programming

### 次のステップ
1. より複雑なルールの実装
2. バックプロパゲーションによる重みの学習
3. 実世界のデータセットでの実験
4. PyTorchやTensorFlowでの実装

---

## 💡 まとめ

Tensor Logicは、AIの2つの主要なパラダイム（**ニューラルネットワーク**と**記号的推論**）を統一する画期的なアプローチです。

このサンプルコードは基礎的な概念を示していますが、実際のアプリケーションでは：
- より複雑なルール体系
- 学習可能なパラメータ
- 大規模なデータセット
- 最適化されたGPU実装

などが必要になります。

Tensor Logicの可能性は広大であり、今後のAI研究・開発において重要な役割を果たすことが期待されています。

---

## 📄 ライセンス

このサンプルコードは教育目的で作成されています。

## 🤝 貢献

改善の提案やバグ報告は歓迎します。

---

**作成日**: 2025年11月4日  
**参考論文**: Pedro Domingos, "Tensor Logic: The Language of AI", arXiv:2510.12269v3

